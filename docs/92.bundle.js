"use strict";(self.webpackChunkcivilization_js=self.webpackChunkcivilization_js||[]).push([[92],{3092:(o,t,e)=>{e.r(t),e.d(t,{Map:()=>g});var n=e(4848),i=e(7339),s=e(6608),r=e(6060),c=e(9980),u=e(3330),a=e(205),l=e(3808),d=e(6501),f=e(2978),v=e(327);function m(o,t,e,n){return e<(o?t/v.B4:n-t/v.B4)}var p=e(3883),h=e(2076);function x({isEditable:o,zIndex:t,map:e,screenSize:r,zoom:v,position:h,opacity:x,onUpdate:y}){const{brush:g}=(0,d.J)().store,{isGridTurnedOn:E}=(0,f.H)().store,M=p.s.hexWidth*v,z=(0,s.df)(M),O=o=>{const t=function({x:o,y:t},e){const n=(0,s.c)(e),i=3*n,r=Math.floor(t/i);let c=r*i;const u=Math.floor(o/e),l=u*e,d=(0,a.Oo)(u,2*r),f=n/2,v=l+e/2;if(t<c+f)return o<v?m(!1,o-l,t-c,f)?(0,a.p8)(d,-1):d:m(!0,o-v,t-c,f)?(0,a.p8)(d,(0,a.Oo)(0,-1)):d;const p=1.5*n;return t<=c+p?d:t<c+2*n?(c+=p,o<v?m(!0,o-l,t-c,f)?d:(0,a.p8)(d,(0,a.Oo)(-1,1)):m(!1,o-v,t-c,f)?d:(0,a.p8)(d,(0,a.Oo)(0,1))):(o<v&&(d.x-=1),(0,a.p8)(d,(0,a.Oo)(0,1)))}(o,M);t.x<0||t.y<0||t.x>=e.rowLength||t.y>=e.columnLength||null===g||e.data[t.y][t.x]===g||(e.data[t.y][t.x]=g,y({map:e}))},{startMoving:L}=(0,c.c)(o=>O((0,a.Ks)((0,a.Oo)(o.offsetX,o.offsetY),h)),o);return(0,n.jsx)(u.g,{screenSize:r,zIndex:t,opacity:x,onMouseDown:o?(o,t)=>{null!==g&&(L(),O((0,a.Ks)(t,h)))}:void 0,children:o=>{for(let t=0;t<e.columnLength&&!(t*z+h.y>r.y);t+=1){const n=e.data[t];for(let e=0;e<n.length&&!(e*M+h.x>r.x);e+=1){const s=n[e];(0,i._)({ctx:o,position:{x:e,y:t},offset:h,width:M,color:l.S[s].color,isGridTurnedOn:E})}}}})}function y({zoom:o,position:t,...e}){const{zoom:i,position:s}=(0,r.K)().store;return(0,n.jsx)(x,{...e,zoom:i*o,position:(0,a.p8)(s,t)})}function g(o){const{store:{isVisible:t,map:e,opacity:i,position:s,zoom:r},setStore:c}=(0,h.P)();return t&&e&&e.columnLength?(0,n.jsx)(y,{...o,map:e,zoom:r,position:s,opacity:i,onUpdate:c}):null}},3330:(o,t,e)=>{e.d(t,{g:()=>r});var n=e(4848),i=e(9860),s=e(2589);function r({zIndex:o,screenSize:t,opacity:e,children:r,...c}){const u=s.L9;return(0,n.jsx)(i.H,{width:t.x,height:t.y-u,style:{zIndex:o,opacity:e,position:"absolute"},...c,children:o=>{o.clearRect(0,0,t.x,t.y-u),r(o)}})}},7339:(o,t,e)=>{e.d(t,{_:()=>r});var n=e(6608),i=e(205);function s(o,t,e){return(0,i.Oo)(o.x+e*Math.cos(t),o.y+e*Math.sin(t))}function r({ctx:o,position:t,offset:e,width:r,color:c,isGridTurnedOn:u}){const a=t.y%2==0?r/2:r,l=(0,n.c)(r),d=(0,n.L$)(l);!function({ctx:o,centerPoint:t,startAngle:e,radius:n,sides:i,fillColor:r,strokeColor:c}){o.beginPath();const u=s(t,e,n);o.moveTo(u.x,u.y);for(let r=0;r<i;r+=1){const c=s(t,r*Math.PI*2/i+e,n);o.lineTo(c.x,c.y)}o.closePath(),r&&(o.fillStyle=r,o.fill()),c&&(o.strokeStyle=c,o.stroke())}({ctx:o,centerPoint:(0,i.Oo)(t.x*r+a+(e?.x||0),t.y*d+l+(e?.y||0)),startAngle:Math.PI/2,radius:l,sides:6,fillColor:c,strokeColor:u?"#000":void 0})}},9860:(o,t,e)=>{e.d(t,{H:()=>r});var n=e(4848),i=e(6540),s=e(205);const r=({children:o,onClick:t,onMouseDown:e,onMouseMove:r,onMouseUp:c,...u})=>{const a=(0,i.useRef)(null),[l,d]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(a.current){const t=a.current.getContext("2d");o(t),d(t)}},[o]),(0,n.jsx)("canvas",{ref:a,...u,onClick:t&&l?o=>t(l,(0,s.Oo)(o.nativeEvent.offsetX,o.nativeEvent.offsetY)):void 0,onMouseDown:e&&l?o=>e(l,(0,s.Oo)(o.nativeEvent.offsetX,o.nativeEvent.offsetY)):void 0,onMouseMove:r&&l?o=>r(l,(0,s.Oo)(o.nativeEvent.offsetX,o.nativeEvent.offsetY)):void 0,onMouseUp:c&&l?o=>c(l,(0,s.Oo)(o.nativeEvent.offsetX,o.nativeEvent.offsetY)):void 0})}},9980:(o,t,e)=>{e.d(t,{c:()=>i});var n=e(6540);function i(o,t=!0){const e=(0,n.useMemo)(()=>({moving:!1,callback:o}),[]);return(0,n.useEffect)(()=>{if(!t)return()=>{};function o(o){e.moving&&requestAnimationFrame(()=>e.callback(o))}function n(o){o.stopPropagation(),e.moving=!1}return document.addEventListener("touchmove",o),document.addEventListener("touchend",n),document.addEventListener("mousemove",o),document.addEventListener("mouseup",n),()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",n),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",n)}},[t]),{startMoving:()=>{e.moving=!0,e.callback=o}}}}}]);