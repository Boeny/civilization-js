"use strict";(self.webpackChunkcivilization_js=self.webpackChunkcivilization_js||[]).push([[92],{391:(t,e,o)=>{o.d(e,{g:()=>r});var n=o(4848),i=o(9860),s=o(2589);function r({zIndex:t,screenSize:e,opacity:o,children:r,...c}){const u=s.L9;return(0,n.jsx)(i.H,{width:e.x,height:e.y-u,style:{zIndex:t,opacity:o,position:"absolute"},...c,children:t=>{t.clearRect(0,0,e.x,e.y-u),r(t)}})}},3092:(t,e,o)=>{o.r(e),o.d(e,{Map:()=>O});var n=o(4848),i=o(7339),s=o(6608),r=o(6060),c=o(9980),u=o(205),f=o(3808),a=o(6501),d=o(391),l=o(2978),v=o(327);function p(t,e,o,n){return o<(t?e/v.B4:n-e/v.B4)}function m({x:t,y:e},o){const n=(0,s.c)(o),i=3*n,r=Math.floor(e/i);let c=r*i;const f=Math.floor(t/o),a=f*o,d=(0,u.Oo)(f,2*r),l=n/2,v=a+o/2;if(e<c+l)return t<v?p(!1,t-a,e-c,l)?(0,u.p8)(d,-1):d:p(!0,t-v,e-c,l)?(0,u.p8)(d,(0,u.Oo)(0,-1)):d;const m=1.5*n;return e<=c+m?d:e<c+2*n?(c+=m,t<v?p(!0,t-a,e-c,l)?d:(0,u.p8)(d,(0,u.Oo)(-1,1)):p(!1,t-v,e-c,l)?d:(0,u.p8)(d,(0,u.Oo)(0,1))):(t<v&&(d.x-=1),(0,u.p8)(d,(0,u.Oo)(0,1)))}var h=o(3883),x=o(2076);function y(t,e,o){return!(t.x<0||t.y<0||t.x>=e.rowLength||t.y>=e.columnLength||e.data[t.y][t.x]===o||(e.data[t.y][t.x]=o,0))}function E(t,e,o,n){return 1===e?y(t,o,n):function(t,e,o){let n=!1;for(const i of t)n=y(i,e,o)||n;return n}([t],o,n)}let M=null;function z({isEditable:t,zIndex:e,map:o,screenSize:r,zoom:v,position:p,opacity:x,onUpdate:y}){const{brush:z,size:g}=(0,a.J)().store,{isGridTurnedOn:O}=(0,l.H)().store,L=h.s.hexWidth*v,k=(0,s.df)(L),{startMoving:S}=(0,c.c)(t=>{if(null===z||!M)return;const e=(0,u.Oo)(t.offsetX,t.offsetY),n=(0,u.Ks)(e,p);(function(t,e,o,n){let i=!1;for(const s of t)i=E(s,e,o,n)||i;return i})(function(t,e,{hexWidth:o,includeStart:n,includeEnd:i,minDistance:s}){let r=[];n&&r.push(t),i&&r.push(e),r=[...r,...(0,u.su)(t,e,s)];const c=[];for(const t of r){const e=m(t,o);c.some(t=>(0,u.F9)(t,e))||c.push(e)}return c}(M,n,{includeStart:!1,includeEnd:!0,hexWidth:L,minDistance:k/1.5*g}),g,o,z)&&y({map:o}),M=n},t);return(0,n.jsx)(d.g,{screenSize:r,zIndex:e,opacity:x,onMouseDown:t?function(t,e){if(null===z)return;S();const n=(0,u.Ks)(e,p);E(m(n,L),g,o,z)&&y({map:o}),M=n}:void 0,children:t=>{for(let e=0;e<o.columnLength&&!(e*k+p.y>r.y);e+=1){const n=o.data[e];for(let o=0;o<n.length&&!(o*L+p.x>r.x);o+=1){const s=n[o];(0,i._)({ctx:t,position:{x:o,y:e},offset:p,width:L,color:f.S[s].color,isGridTurnedOn:O})}}}})}function g({zoom:t,position:e,...o}){const{zoom:i,position:s}=(0,r.K)().store;return(0,n.jsx)(z,{...o,zoom:i*t,position:(0,u.p8)(s,e)})}function O(t){const{store:{isVisible:e,map:o,opacity:i,position:s,zoom:r},setStore:c}=(0,x.P)();return e&&o&&o.columnLength?(0,n.jsx)(g,{...t,map:o,zoom:r,position:s,opacity:i,onUpdate:c}):null}},7339:(t,e,o)=>{o.d(e,{_:()=>r});var n=o(6608),i=o(205);function s(t,e,o){return(0,i.Oo)(t.x+o*Math.cos(e),t.y+o*Math.sin(e))}function r({ctx:t,position:e,offset:o,width:r,color:c,isGridTurnedOn:u}){const f=e.y%2==0?r/2:r,a=(0,n.c)(r),d=(0,n.L$)(a);!function({ctx:t,centerPoint:e,startAngle:o,radius:n,sides:i,fillColor:r,strokeColor:c}){t.beginPath();const u=s(e,o,n);t.moveTo(u.x,u.y);for(let r=0;r<i;r+=1){const c=s(e,r*Math.PI*2/i+o,n);t.lineTo(c.x,c.y)}t.closePath(),r&&(t.fillStyle=r,t.fill()),c&&(t.strokeStyle=c,t.stroke())}({ctx:t,centerPoint:(0,i.Oo)(e.x*r+f+(o?.x||0),e.y*d+a+(o?.y||0)),startAngle:Math.PI/2,radius:a,sides:6,fillColor:c,strokeColor:u?"#000":void 0})}},9860:(t,e,o)=>{o.d(e,{H:()=>r});var n=o(4848),i=o(6540),s=o(205);const r=({children:t,onClick:e,onMouseDown:o,onMouseMove:r,onMouseUp:c,...u})=>{const f=(0,i.useRef)(null),[a,d]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(f.current){const e=f.current.getContext("2d");t(e),d(e)}},[t]),(0,n.jsx)("canvas",{ref:f,...u,onClick:e&&a?t=>e(a,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0,onMouseDown:o&&a?t=>o(a,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0,onMouseMove:r&&a?t=>r(a,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0,onMouseUp:c&&a?t=>c(a,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0})}},9980:(t,e,o)=>{o.d(e,{c:()=>i});var n=o(6540);function i(t,e=!0){const o=(0,n.useRef)(!1),i=(0,n.useRef)(t);return(0,n.useEffect)(()=>{if(!e)return()=>{};function t(t){o.current&&requestAnimationFrame(()=>i.current(t))}function n(t){t.stopPropagation(),o.current=!1}return document.addEventListener("touchmove",t),document.addEventListener("touchend",n),document.addEventListener("mousemove",t),document.addEventListener("mouseup",n),()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n),document.removeEventListener("touchmove",t),document.removeEventListener("touchend",n)}},[e]),{startMoving:()=>{o.current=!0,i.current=t}}}}}]);