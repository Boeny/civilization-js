"use strict";(self.webpackChunkcivilization_js=self.webpackChunkcivilization_js||[]).push([[92],{3092:(t,o,e)=>{e.r(o),e.d(o,{Map:()=>w});var n=e(4848),i=e(7339),s=e(6608),r=e(6060),c=e(9980),u=e(3330),a=e(205),l=e(3808),d=e(6501),f=e(2978),x=e(327);function v(t,o,e,n){return e<(t?o/x.B4:n-o/x.B4)}function y({x:t,y:o},e){const n=(0,s.c)(e),i=3*n,r=Math.floor(o/i);let c=r*i;const u=Math.floor(t/e),l=u*e,d=(0,a.Oo)(u,2*r),f=n/2,x=l+e/2;if(o<c+f)return t<x?v(!1,t-l,o-c,f)?(0,a.p8)(d,-1):d:v(!0,t-x,o-c,f)?(0,a.p8)(d,(0,a.Oo)(0,-1)):d;const y=1.5*n;return o<=c+y?d:o<c+2*n?(c+=y,t<x?v(!0,t-l,o-c,f)?d:(0,a.p8)(d,(0,a.Oo)(-1,1)):v(!1,t-x,o-c,f)?d:(0,a.p8)(d,(0,a.Oo)(0,1))):(t<x&&(d.x-=1),(0,a.p8)(d,(0,a.Oo)(0,1)))}var m=e(3883),p=e(2076);function h(t,o,e){return!(t.x<0||t.y<0||t.x>=o.rowLength||t.y>=o.columnLength||o.data[t.y][t.x]===e||(o.data[t.y][t.x]=e,0))}let E=null;function M({isEditable:t,zIndex:o,map:e,screenSize:r,zoom:v,position:p,opacity:M,onUpdate:g}){const{brush:w}=(0,d.J)().store,{isGridTurnedOn:z}=(0,f.H)().store,O=m.s.hexWidth*v,L=(0,s.df)(O),{startMoving:k}=(0,c.c)(t=>{if(null===w||!E)return;const o=(0,a.Oo)(t.offsetX,t.offsetY),n=(0,a.Ks)(o,p);(function(t,o,e){let n=!1;for(const i of t)n=h(i,o,e)||n;return n})(function(t,o,e){const n=[];e.includeStart&&n.push(t),e.includeEnd&&n.push(o);const i=(0,s.c)(e.hexWidth);let r=[];if((0,a.wQ)((0,a.Ks)(o,t))>i){let e=0;if(Math.abs(t.y-o.y)<1)r=t.x<o.x?(0,a.Vw)(t.x,o.x,i).map(t=>({x:t,y:o.y})):(0,a.Vw)(o.x,t.x,i).map(o=>({x:o,y:t.y}));else if(Math.abs(t.x-o.x)<1)r=t.y<o.y?(0,a.Vw)(t.y,o.y,i).map(t=>({y:t,x:o.x})):(0,a.Vw)(o.y,t.y,i).map(o=>({y:o,x:t.x}));else{e=(t.y-o.y)/(t.x-o.x);const n=t.y-t.x*e,s=i/x.IG;r=e<=1?t.x<o.x?(0,a.Vw)(t.x,o.x,s).map(t=>({x:t,y:e*t+n})):(0,a.Vw)(o.x,t.x,s).map(t=>({x:t,y:e*t+n})):t.y<o.y?(0,a.Vw)(t.y,o.y,s).map(t=>({y:t,x:(t-n)/e})):(0,a.Vw)(o.y,t.y,s).map(t=>({y:t,x:(t-n)/e}))}}return[...n,...r].map(t=>y(t,e.hexWidth))}(E,n,{includeStart:!1,includeEnd:!0,hexWidth:O}),e,w)&&g({map:e}),E=n},t);return(0,n.jsx)(u.g,{screenSize:r,zIndex:o,opacity:M,onMouseDown:t?function(t,o){if(null===w)return;k();const n=(0,a.Ks)(o,p);h(y(n,O),e,w)&&g({map:e}),E=n}:void 0,children:t=>{for(let o=0;o<e.columnLength&&!(o*L+p.y>r.y);o+=1){const n=e.data[o];for(let e=0;e<n.length&&!(e*O+p.x>r.x);e+=1){const s=n[e];(0,i._)({ctx:t,position:{x:e,y:o},offset:p,width:O,color:l.S[s].color,isGridTurnedOn:z})}}}})}function g({zoom:t,position:o,...e}){const{zoom:i,position:s}=(0,r.K)().store;return(0,n.jsx)(M,{...e,zoom:i*t,position:(0,a.p8)(s,o)})}function w(t){const{store:{isVisible:o,map:e,opacity:i,position:s,zoom:r},setStore:c}=(0,p.P)();return o&&e&&e.columnLength?(0,n.jsx)(g,{...t,map:e,zoom:r,position:s,opacity:i,onUpdate:c}):null}},3330:(t,o,e)=>{e.d(o,{g:()=>r});var n=e(4848),i=e(9860),s=e(2589);function r({zIndex:t,screenSize:o,opacity:e,children:r,...c}){const u=s.L9;return(0,n.jsx)(i.H,{width:o.x,height:o.y-u,style:{zIndex:t,opacity:e,position:"absolute"},...c,children:t=>{t.clearRect(0,0,o.x,o.y-u),r(t)}})}},7339:(t,o,e)=>{e.d(o,{_:()=>r});var n=e(6608),i=e(205);function s(t,o,e){return(0,i.Oo)(t.x+e*Math.cos(o),t.y+e*Math.sin(o))}function r({ctx:t,position:o,offset:e,width:r,color:c,isGridTurnedOn:u}){const a=o.y%2==0?r/2:r,l=(0,n.c)(r),d=(0,n.L$)(l);!function({ctx:t,centerPoint:o,startAngle:e,radius:n,sides:i,fillColor:r,strokeColor:c}){t.beginPath();const u=s(o,e,n);t.moveTo(u.x,u.y);for(let r=0;r<i;r+=1){const c=s(o,r*Math.PI*2/i+e,n);t.lineTo(c.x,c.y)}t.closePath(),r&&(t.fillStyle=r,t.fill()),c&&(t.strokeStyle=c,t.stroke())}({ctx:t,centerPoint:(0,i.Oo)(o.x*r+a+(e?.x||0),o.y*d+l+(e?.y||0)),startAngle:Math.PI/2,radius:l,sides:6,fillColor:c,strokeColor:u?"#000":void 0})}},9860:(t,o,e)=>{e.d(o,{H:()=>r});var n=e(4848),i=e(6540),s=e(205);const r=({children:t,onClick:o,onMouseDown:e,onMouseMove:r,onMouseUp:c,...u})=>{const a=(0,i.useRef)(null),[l,d]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(a.current){const o=a.current.getContext("2d");t(o),d(o)}},[t]),(0,n.jsx)("canvas",{ref:a,...u,onClick:o&&l?t=>o(l,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0,onMouseDown:e&&l?t=>e(l,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0,onMouseMove:r&&l?t=>r(l,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0,onMouseUp:c&&l?t=>c(l,(0,s.Oo)(t.nativeEvent.offsetX,t.nativeEvent.offsetY)):void 0})}},9980:(t,o,e)=>{e.d(o,{c:()=>i});var n=e(6540);function i(t,o=!0){const e=(0,n.useMemo)(()=>({moving:!1,callback:t}),[]);return(0,n.useEffect)(()=>{if(!o)return()=>{};function t(t){e.moving&&requestAnimationFrame(()=>e.callback(t))}function n(t){t.stopPropagation(),e.moving=!1}return document.addEventListener("touchmove",t),document.addEventListener("touchend",n),document.addEventListener("mousemove",t),document.addEventListener("mouseup",n),()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n),document.removeEventListener("touchmove",t),document.removeEventListener("touchend",n)}},[o]),{startMoving:()=>{e.moving=!0,e.callback=t}}}}}]);